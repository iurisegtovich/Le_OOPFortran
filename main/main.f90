module modulo1
!
!------------------------------------------------------------------------------------------------------------------------------
!
  implicit none
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type, abstract :: t1
    !nothing here
  contains
    procedure(p1abs), deferred :: p1
  end type
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type,extends(t1) :: t11
  !nothing here
  contains
    procedure :: p1 => p11
  end type
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type,extends(t1) :: t12
  !nothing here
  contains
    procedure :: p1 => p12
  end type
!
!------------------------------------------------------------------------------------------------------------------------------
!
  interface
    subroutine p1abs(z)
     import :: t1
     implicit none
     class(t1) :: z
    end subroutine
  end interface
!
!------------------------------------------------------------------------------------------------------------------------------
!
contains
!
!------------------------------------------------------------------------------------------------------------------------------
!
  function constructor_t11() result(z)
    type(t11) :: z
  end function
!
!------------------------------------------------------------------------------------------------------------------------------
!
  function constructor_t12() result(z)
    type(t12) :: z
  end function
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine p11(z)
   class(t11) :: z
   print*, 'p11 ',__FILE__, __LINE__
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine p12(z)
   class(t12) :: z
   print*, 'p12 ',__FILE__, __LINE__
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
end module
!
!############################################################################################################################################################################################################
!
module modulo2
!
!------------------------------------------------------------------------------------------------------------------------------
!
  implicit none
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type :: t2
    procedure(p2abs), pointer :: p2 => null()
  contains
    !nothing here
  end type
!
!------------------------------------------------------------------------------------------------------------------------------
!
  interface
    subroutine p2abs(z)
      import :: t2
      implicit none
      class(t2) :: z
    end subroutine
  end interface
!
!------------------------------------------------------------------------------------------------------------------------------
!
contains
!
!------------------------------------------------------------------------------------------------------------------------------
!
  function constructor_t21() result(z)
    type(t2) :: z
    z%p2=>p21
  end function
!
!------------------------------------------------------------------------------------------------------------------------------
!
  function constructor_t22() result(z)
    type(t2) :: z
    z%p2=>p22
  end function
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine p21(z)
   class(t2) :: z
   print*, 'p21 ',__FILE__, __LINE__
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine p22(z)
   class(t2) :: z
   print*, 'p22 ',__FILE__, __LINE__
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
end module
!
!############################################################################################################################################################################################################
!
module mmain
  use modulo1
  use modulo2
  implicit none
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type main_C
    !nothing here
  contains
    procedure :: main_s
    procedure :: main_s1
    procedure :: main_s2
  end type
!
!------------------------------------------------------------------------------------------------------------------------------
!
contains
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine main_s(z)
    class(main_c) :: z
    call z%main_s1()
    call z%main_s2()
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine main_s1(z)
    class(main_c) :: z
    class(t1), pointer :: t11_o, t12_o
    allocate(t11_o, source=constructor_t11())
    call t11_o%p1
    allocate(t12_o, source=constructor_t12())
    call t12_o%p1
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
  subroutine main_s2(z)
    class(main_c) :: z
    class(t2), pointer :: t21_o, t22_o
    allocate(t21_o, source=constructor_t21())
    call t21_o%p2
    allocate(t22_o, source=constructor_t22())
    call t22_o%p2
  end subroutine
!
!------------------------------------------------------------------------------------------------------------------------------
!
end module
!
!------------------------------------------------------------------------------------------------------------------------------
!
program main
  use mmain
  implicit none
!
!------------------------------------------------------------------------------------------------------------------------------
!
  type(main_c) :: main_o
!
!------------------------------------------------------------------------------------------------------------------------------
!
  call main_o%main_s()
!
!------------------------------------------------------------------------------------------------------------------------------
!
end program
